<div>
  <div>
    <h1>
      List of all messages
    </h1>
  </div>
</div>

<hr>

<div>
  <div>
    <h2>
      Add a new message
    </h2>

    <form action="/insert_message" method="post">

            <div>
        <label for="recipient_id_box">
          Recipient
        </label>
              <select id="recipient_id_box" name="query_recipient_id" class="form-select">
                <% User.all.order(:last_name).each do |a_user| %>
                <% next if a_user.id == @current_user.id %>
                  <option value="<%= a_user.id %>">
                    <%= a_user.first_name %> <%= a_user.last_name %>
                  </option>
                <% end %>
              </select>
            </div>


          <div class="form-group">
      <label for="body_box" class="form-label mt-4">Message</label>

      <textarea class="form-control" id="body_box" name="query_body" rows="5"></textarea>
    </div>



      <button>
        Create message
      </button>
    </form>
  </div>
</div>
<hr>

<h1>Messages</h1>



<ul>
<% @messages.each do |conversation, messages| %>
    <% if conversation.include?(@current_user.id) %>
    <li>
      <strong>Conversation between <%= conversation[0].first_name %> and <%= conversation[1].first_name %>:</strong>
      <ul>
        <% messages.each do |message| %>
          <li>
            <%= message.body %>
          </li>
        <% end %>
      </ul>
    </li>
    <% end %>
  <% end %>
</ul>



<hr>
<div>
  <div>
    <table border="1">
      <tr>
        <th>
          ID
        </th>

        <th>
          Sender
        </th>

        <th>
          Recipient
        </th>

        <th>
          Body
        </th>

        <th>
          Created at
        </th>

        <th>
          Updated at
        </th>

        <th>
        </th>
      </tr>

      <% @list_of_messages.each do |a_message| %>
      <tr>
        <td>
          <%= a_message.id %>
        </td>

        <td>
          <%= a_message.sender_id %>
        </td>

        <td>
          <%= a_message.recipient_id %>
        </td>

        <td>
          <%= a_message.body %>
        </td>

        <td>
          <%= time_ago_in_words(a_message.created_at) %> ago
        </td>
        <td>
          <%= time_ago_in_words(a_message.updated_at) %> ago
        </td>

        <td>
          <a href="/messages/<%= a_message.id %>">
            Show details
          </a>
        </td>
      </tr>
      <% end %>
    </table>
  </div>
</div>

<hr>
